<?xml version="1.0" encoding="utf-8" ?>

<configuration xmlns:patch="http://www.sitecore.net/xmlconfig/" xmlns:role="http://www.sitecore.net/xmlconfig/role/">
  <sitecore>
    <settings>
      <setting name="SitecoreMvcOtel.ServiceName" value="sitecore-cm" role:require="Standalone or ContentManagement" />
      <setting name="SitecoreMvcOtel.ServiceName" value="sitecore-cd" role:require="ContentDelivery" />
      <setting name="SitecoreMvcOtel.Exporter.EndpointUri" value="http://aspire-dashboard:18889" />
      <setting name="SitecoreMvcOtel.Exporter.Protocol" value="grpc" />
      <setting name="SitecoreMvcOtel.Traces.UseAlwaysOnSampler" value="true" />
      <setting name="SitecoreMvcOtel.Instrumentation.UseSqlClientInstrumentation" value="false" />
    </settings>

    <!--TEST-->
    
    <dataApis>
      <dataApi name="SqlServer" type="Sitecore.Data.SqlServer.SqlServerDataApi, Sitecore.Kernel">
        <patch:attribute name="type">SitecoreMvcOtel.OtelSqlServerDataApi, SitecoreMvcOtel</patch:attribute>
      </dataApi>
    </dataApis>

    <dataProviders>
      <main>
        <patch:attribute name="type">SitecoreMvcOtel.OtelSqlServerDataProvider, SitecoreMvcOtel</patch:attribute>
      </main>
    </dataProviders>
    <!--/TEST-->

    <!--<pipelines>
      <httpRequestBegin>
        <processor type="SitecoreMvcOtel.Pipelines.OtelHttpRequestBeginStart, SitecoreMvcOtel" patch:before = "*[1]" resolve="true"/>
        --><!--<processor type="SitecoreMvcOtel.Pipelines.OtelHttpRequestBeginStop, SitecoreMvcOtel" patch:before="processor[@type='Sitecore.Pipelines.HttpRequest.ExecuteRequest, Sitecore.Kernel']" />--><!--
      </httpRequestBegin>
    </pipelines>-->

    <services>
      <configurator patch:before="*[1]" type= "SitecoreMvcOtel.ServiceConfigurator, SitecoreMvcOtel" />
    </services>

    <log4net>
      <appender name="LogFileAppender">
        <patch:delete />
      </appender>
      <appender name="LogFileAppender">
        <patch:attribute name="type">SitecoreMvcOtel.Logging.MsForwardingAppender, SitecoreMvcOtel</patch:attribute>
        <category value="system" />
      </appender>

      <appender name="PublishingLogFileAppender">
        <patch:delete />
      </appender>
      <appender name="PublishingLogFileAppender">
        <patch:attribute name="type">SitecoreMvcOtel.Logging.MsForwardingAppender, SitecoreMvcOtel</patch:attribute>
        <category value="publish" />
      </appender>

      <appender name="ClientLogAppender">
        <patch:delete />
      </appender>
      <appender name="ClientLogAppender">
        <patch:attribute name="type">SitecoreMvcOtel.Logging.MsForwardingAppender, SitecoreMvcOtel</patch:attribute>
        <category value="client" />
      </appender>

      <appender name="SearchLogFileAppender">
        <patch:delete />
      </appender>
      <appender name="SearchLogFileAppender">
        <patch:attribute name="type">SitecoreMvcOtel.Logging.MsForwardingAppender, SitecoreMvcOtel</patch:attribute>
        <category value="search" />
      </appender>

      <appender name="CrawlingLogFileAppender">
        <patch:delete />
      </appender>
      <appender name="CrawlingLogFileAppender">
        <patch:attribute name="type">SitecoreMvcOtel.Logging.MsForwardingAppender, SitecoreMvcOtel</patch:attribute>
        <category value="crawl" />
      </appender>

      <appender name="OwinLogFileAppender">
        <patch:delete />
      </appender>
      <appender name="OwinLogFileAppender">
        <patch:attribute name="type">SitecoreMvcOtel.Logging.MsForwardingAppender, SitecoreMvcOtel</patch:attribute>
        <category value="owin" />
      </appender>
    </log4net>
  </sitecore>
</configuration>